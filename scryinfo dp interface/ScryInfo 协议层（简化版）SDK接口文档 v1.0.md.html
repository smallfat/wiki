<!DOCTYPE html><html lang="en"><head>
<title> ScryInfo 协议层（简化版）SDK接口文档 v1.0.md</title>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="()">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<style type="text/css">
body h1,p{line-height:1.6}body,pre{word-break:break-word}.tag.label,.xsj_mindmap_caption,kbd{display:inline-block}body,kbd{color:#839496}img,kbd{vertical-align:middle}address,dl{margin-bottom:20px}blockquote p,ol ol,ol ul,ul ol,ul ul{margin-bottom:0}address,blockquote small{display:block;line-height:20px}address,blockquote small,dd,dt{line-height:20px}.xiaoshujiang_pre,pre{word-wrap:break-word;tab-size:4;white-space:pre-wrap}.li_linenum,.xiaoshujiang_code.hljs.code_linenums,code.hljs.code_linenums{position:relative}img,table{max-width:100%}body{font-family:'Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB',STHeiti,"Microsoft YaHei","微软雅黑",'WenQuanYi Micro Hei',STXihei,"华文细黑",Heiti,"黑体",SimSun,"宋体",Song,sans-serif;font-size:16px;line-height:1.33;font-weight:100;background:#002b36;word-wrap:break-word;letter-spacing:0;word-spacing:.25em}a:focus{outline:#2aa198 dotted thin;outline:-webkit-focus-ring-color auto 5px;outline-offset:-2px}a:active,a:hover{outline:0}a{color:#2aa198;text-decoration:none}a:hover{text-decoration:underline}h1,h2,h3,h4,h5,h6{margin:1em 0 .6em;font-family:inherit;font-weight:500;line-height:2.35rem;color:inherit;text-rendering:optimizelegibility}.mermaid_svg,.xiaoshujiang_pre,pre{font-family:monospace}h1{font-size:3.4rem}h2{font-size:3rem}h3{font-size:2.45rem}h4{font-size:2.1rem}h5{font-size:1.9rem}h6{font-size:1.5rem}body h2,body h3{line-height:1.1}hr{margin:20px 0;border:0;border-top:1px dashed #839496;border-left:90px solid transparent;border-right:90px solid transparent}p{margin:0 0 1.1em}pre{line-height:initial!important}kbd{padding:3px 5px;font-size:11px;line-height:10px;background-color:#fcfcfc;border:1px solid #839496;border-bottom-color:#839496;border-radius:3px;box-shadow:inset 0 -1px 0 #839496}address{font-style:normal}img{height:auto;border:0}table{background-color:transparent;border-collapse:collapse;border-spacing:0;word-break:initial;border:1px solid #839496}small{font-size:85%}dt,strong{font-weight:700}em{font-style:italic}cite{font-style:normal}ol,ul{color:#669199;padding:0;margin:0 0 10px 35px}dd{margin-left:10px}body dd,body dt{line-height:1.35em}abbr[data-original-title],abbr[title]{cursor:help;border-bottom:1px dotted #999}blockquote{padding:0 0 0 15px;margin:0 0 20px;border-left:10px solid rgba(133,153,0,.4);background:rgba(133,153,0,.1)}blockquote p{display:inline;font-size:16px;font-weight:300;line-height:25px}.table th,.tag.label{font-weight:700}blockquote small{color:#999}blockquote small:before{content:'\2014 \00A0'}blockquote footer{margin:1em 0;font-style:italic}blockquote footer cite{margin:0 1em}code{background-color:rgba(54,147,211,.1);color:#268bd2;border-radius:4px;padding:2px 4px}body code{border:0;border-radius:4px;font-size:90%}text{font-size:14px}h1.story_title{margin:.7em 0}.story_tags{margin:0 0 1.2em}.tag.label{vertical-align:baseline;line-height:1;margin:.125em;background-color:rgba(133,153,0,.15);color:#859900;border-color:rgba(133,153,0,.15);background-image:none;padding:.6em .8em;text-transform:none;border-radius:.2857rem;box-sizing:border-box;font-size:12px}.table{width:100%;margin-bottom:20px;margin-right:auto;margin-left:auto}.table td,.table th{padding:8px;line-height:20px;text-align:left;vertical-align:top;border-top:1px solid #839496}.table thead th{vertical-align:bottom}.table caption+thead tr:first-child td,.table caption+thead tr:first-child th,.table colgroup+thead tr:first-child td,.table colgroup+thead tr:first-child th,.table thead:first-child tr:first-child td,.table thead:first-child tr:first-child th{border-top:0}.table tbody+tbody{border-top:2px solid #839496}.table .table,.table-striped tbody>tr:nth-child(odd)>td,.table-striped tbody>tr:nth-child(odd)>th{background-color:rgba(102,145,153,.1)}.table-celled.table tr td,.table-celled.table tr th{border-left:1px solid #839496}.table-celled.table tr td:first-child,.table-celled.table tr th:first-child{border-left:none}.mindmap_container{text-align:center}.xsj_mindmap_caption{border-bottom:1px solid #586e75;color:#586e75;padding:10px}.hljs,.hljs *{overflow:visible!important}body .xiaoshujiang_code{border:0;border-radius:4px;font-size:90%}.xiaoshujiang_code ol{margin-bottom:0}.xiaoshujiang_pre{line-height:initial!important;word-break:break-word}.xiaoshujiang_code_container pre{margin:0}.xiaoshujiang_code_container.xiaoshujiang_code_chunk{box-shadow:0 0 0 1px #A3C293 inset,0 0 0 0 transparent;margin:1em 0;padding:1em}.xiaoshujiang_code_container.xiaoshujiang_code_chunk_hide_code{box-shadow:initial;padding:initial initial 2em}.xiaoshujiang_code_container .out_put{box-shadow:0 0 0 1px #A3C293 inset,0 0 0 0 transparent;margin:1em 0;background-color:#FCFFF5;padding:1em}.xiaoshujiang_code_container .out_put_error{background-color:#FFF6F6;color:#9F3A38;margin:1em 0;box-shadow:0 0 0 1px #E0B4B4 inset,0 0 0 0 transparent;padding:1em}.ol_linenums{padding:0;margin-left:2em;border-left:1px solid #839496}.li_linenum{margin-left:.5em;list-style:none;counter-increment:lines 1}.li_linenum.li_list_style{list-style:inherit;margin-left:5px}.li_linenum:before,.li_linenum_before_span{content:counter(lines,decimal);position:absolute;left:-3em;text-align:center;width:2.5em;vertical-align:top}.li_linenum_before_span_hide{display:none}.xiaoshujiang_code_container{margin:1em 0;position:relative;padding-bottom:2em}.xiaoshujiang_code_title_container{font-size:70%;opacity:.5}.xiaoshujiang_code_title_container>.xiaoshujiang_code_infos{float:right}.mark{border:0;background-color:rgba(133,153,0,.15);color:#859900;padding:2px 4px}.line_mark{border:1px dashed #839496;margin-top:2px}.xiaoshujiang_code .mark,code .mark{border-radius:0;font-size:initial;padding:initial}a.attachment{border:1px solid #839496;display:inline-block;padding:5px;margin:2px;min-width:250px}a.attachment i.fa{font-size:3em;float:left;margin-right:.2em}a.attachment .filename{vertical-align:top;text-align:left;font-weight:700}.flow-chart,.mermaid,.plot,.plot-image,.sequence-diagram,.story_image_container,.story_remote_resource_block,.video_container{text-align:center}a.attachment .filesize{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;opacity:.6;font-size:80%;white-space:nowrap}.story_image_container>.story_image{display:inline-block;position:relative;max-width:100%}.story_image_caption{border-bottom:1px solid #586e75;display:inline-block;color:#586e75;padding:10px}.story_image_blank_caption{border-bottom:0}.story_image>img{border-radius:.3125em;box-shadow:0 2px 4px 0 rgba(88,110,117,.4),0 2px 10px 0 rgba(88,110,117,.5)}.story_inline_image>img{vertical-align:bottom}.task-list-item{list-style:none}.task-list-item.li_list_style{list-style:inherit}.task-list-item>input{margin:0 0 0 -20px}.video_container{width:100%;display:table;position:relative;padding-bottom:56.25%!important}.video_container iframe{width:100%;height:100%;position:absolute;top:0;left:0;z-index:1;vertical-align:middle}.slideshare_container .inner{position:relative;width:100%}.slideshare_container .inner iframe{width:100%;height:100%;position:absolute;top:0;bottom:0;left:0;right:0}.toc ul{list-style-type:none}em.cjk_emphasis{font-style:normal;font-family:Georgia,"Times New Roman",Times,"楷体","AR PL UKai CN",NSimSun,"Songti SC",SimSun,serif!important}.plot,.plot-image{min-height:200px;min-width:200px}.story_align_left,.story_align_left .story_image_container{text-align:left}.story_align_right,.story_align_right .story_image_container{text-align:right}.story_align_center,.story_align_center .story_image_container{text-align:center}.story_align_justify,.story_align_justify .story_image_container{text-align:justify}.mathjax-container{text-align:center}div.mathjax{max-width:600px;margin:0 auto;font-size:14px}.hljs{border:1px dashed #839496}.preview.html_preview{max-width:10in;margin:0 auto}@media print{body{font-size:18px;word-wrap:break-word;word-break:break-word;background:initial;font-kerning:normal;text-rendering:geometricPrecision}.xiaoshujiang_element.xsj_anchor{position:absolute}.story_image_container,tr{page-break-inside:avoid}.xsj_underline{page-break-after:always;visibility:hidden}}
/*

Orginal Style from ethanschoonover.com/solarized (c) Jeremy Hull <sourdrums@gmail.com>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #fdf6e3;
  color: #657b83;
}

.hljs-comment,
.hljs-quote {
  color: #93a1a1;
}

/* Solarized Green */
.hljs-keyword,
.hljs-selector-tag,
.hljs-addition {
  color: #859900;
}

/* Solarized Cyan */
.hljs-number,
.hljs-string,
.hljs-meta .hljs-meta-string,
.hljs-literal,
.hljs-doctag,
.hljs-regexp {
  color: #2aa198;
}

/* Solarized Blue */
.hljs-title,
.hljs-section,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class {
  color: #268bd2;
}

/* Solarized Yellow */
.hljs-attribute,
.hljs-attr,
.hljs-variable,
.hljs-template-variable,
.hljs-class .hljs-title,
.hljs-type {
  color: #b58900;
}

/* Solarized Orange */
.hljs-symbol,
.hljs-bullet,
.hljs-subst,
.hljs-meta,
.hljs-meta .hljs-keyword,
.hljs-selector-attr,
.hljs-selector-pseudo,
.hljs-link {
  color: #cb4b16;
}

/* Solarized Red */
.hljs-built_in,
.hljs-deletion {
  color: #dc322f;
}

.hljs-formula {
  background: #eee8d5;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

/**
 * Treeview syntax highlighting based on highlight.js
 * Copyright (c) 2014-2015, Asciidocfx Team, (MIT Licensed)
 * https://github.com/asciidocfx/highlight-treeview.js
 */
.language-treeview.hljs{
  position: relative;
}
.hljs-folder,
.hljs-hiddenfile,
.hljs-file {
    position: relative;
    vertical-align: top;
    display: inline-block;
    height: 16px;
}
.hljs-folder:before,
.hljs-file:before,
.hljs-hiddenfile:before {
    top: 0;
    content: '';
    width: 14px;
    height: 12px;
    margin-top: 0px;
    margin-right: 3px;
    position: relative;
    display: inline-block;
    background-size: 14px;
    background-repeat: no-repeat;
}
.hljs-file:before,
.hljs-hiddenfile:before {
    height: 14px;
    margin-left: 1px;
}
.hljs-hiddenfile {
    opacity: 0.6;
}
.hljs-file.photo:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f1c5";
}
.hljs-file.plain:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f016";
}
.hljs-file.source:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f1c9";
}
.hljs-file.archive:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f1c6";
}
.hljs-file.audio:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f1c7";
}
.hljs-file.video:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f1c8";
}
.hljs-file.pdf:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f1c1";
}
.hljs-file.xls:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f1c3";
}
.hljs-file.doc:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f1c2";
}
.hljs-file.ppt:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f1c4";
}
.hljs-folder:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f114";
}
.hljs-hiddenfile:before {
    font: normal normal normal 14px/1 FontAwesome;
    content: "\f016";
}
.hljs-tvline {
    margin-left: 6px;
    position: absolute;
    text-indent: -99em;
    padding-bottom: 8px;
    vertical-align: top;
    display: inline-block;
    border-left-width: 1px;
    border-left-style: solid;
    border-left-color: rgb(94, 144, 117);
}
.hljs-folder-branch {
    width: 8px;
    height: 8px;
    margin-top: -1px;
    margin-left: 6px;
    text-indent: -99em;
    position: relative;
    vertical-align: top;
    display: inline-block;
    border-bottom-width: 1px;
    border-bottom-style: solid;
    border-bottom-color: rgb(94, 144, 117);
}
.hljs-folder-branch.win {
    width: 14px;
    margin-right: 2px;
}
.hljs-folder-last-branch {
    height: 7px;
    width: 7px;
    margin-left: 6px;
    text-indent: -99em;
    position: relative;
    vertical-align: top;
    display: inline-block;
    border-bottom-width: 1px;
    border-bottom-style: solid;
    border-bottom-color: rgb(94, 144, 117);
    border-left-width: 1px;
    border-left-style: solid;
    border-left-color: rgb(94, 144, 117);
}
.hljs-folder-last-branch.win {
    width: 13px;
    margin-right: 2px;
}


/**
 * Treeview syntax highlighting based on highlight.js
 */

/*wavedrom start*/

.wavedrom_svg text, .wavedrom_svg_defs text {
    font-size:11pt;
    font-style:normal;
    font-variant:normal;
    font-weight:normal;
    font-stretch:normal;
    text-align:center;
    fill-opacity:1;
    font-family:Helvetica
}
.wavedrom_svg .muted, .wavedrom_svg_defs .muted {
    fill:#aaa
}
.wavedrom_svg .warning, .wavedrom_svg_defs .warning {
    fill:#f6b900
}
.wavedrom_svg .error, .wavedrom_svg_defs .error {
    fill:#f60000
}
.wavedrom_svg .info, .wavedrom_svg_defs .info {
    fill:#0041c4
}
.wavedrom_svg .success, .wavedrom_svg_defs .success {
    fill:#00ab00
}
.wavedrom_svg .h1, .wavedrom_svg_defs .h1 {
    font-size:33pt;
    font-weight:bold
}
.wavedrom_svg .h2, .wavedrom_svg_defs .h2 {
    font-size:27pt;
    font-weight:bold
}
.wavedrom_svg .h3, .wavedrom_svg_defs .h3 {
    font-size:20pt;
    font-weight:bold
}
.wavedrom_svg .h4, .wavedrom_svg_defs .h4 {
    font-size:14pt;
    font-weight:bold
}
.wavedrom_svg .h5, .wavedrom_svg_defs .h5 {
    font-size:11pt;
    font-weight:bold
}
.wavedrom_svg .h6, .wavedrom_svg_defs .h6 {
    font-size:8pt;
    font-weight:bold
}
.wavedrom_svg_defs .s1 {
    fill:none;
    stroke:#000;
    stroke-width:1;
    stroke-linecap:round;
    stroke-linejoin:miter;
    stroke-miterlimit:4;
    stroke-opacity:1;
    stroke-dasharray:none
}
.wavedrom_svg_defs .s2 {
    fill:none;
    stroke:#000;
    stroke-width:0.5;
    stroke-linecap:round;
    stroke-linejoin:miter;
    stroke-miterlimit:4;
    stroke-opacity:1;
    stroke-dasharray:none
}
.wavedrom_svg_defs .s3 {
    color:#000;
    fill:none;
    stroke:#000;
    stroke-width:1;
    stroke-linecap:round;
    stroke-linejoin:miter;
    stroke-miterlimit:4;
    stroke-opacity:1;
    stroke-dasharray:1,3;
    stroke-dashoffset:0;
    marker:none;
    visibility:visible;
    display:inline;
    overflow:visible;
    enable-background:accumulate
}
.wavedrom_svg_defs .s4 {
    color:#000;
    fill:none;
    stroke:#000;
    stroke-width:1;
    stroke-linecap:round;
    stroke-linejoin:miter;
    stroke-miterlimit:4;
    stroke-opacity:1;
    stroke-dasharray:none;
    stroke-dashoffset:0;
    marker:none;
    visibility:visible;
    display:inline;
    overflow:visible
}
.wavedrom_svg_defs .s5 {
    fill:#fff;
    stroke:none
}
.wavedrom_svg_defs .s6 {
    color:#000;
    fill:#ffffb4;
    fill-opacity:1;
    fill-rule:nonzero;
    stroke:none;
    stroke-width:1px;
    marker:none;
    visibility:visible;
    display:inline;
    overflow:visible;
    enable-background:accumulate
}
.wavedrom_svg_defs .s7 {
    color:#000;
    fill:#ffe0b9;
    fill-opacity:1;
    fill-rule:nonzero;
    stroke:none;
    stroke-width:1px;
    marker:none;
    visibility:visible;
    display:inline;
    overflow:visible;
    enable-background:accumulate
}
.wavedrom_svg_defs .s8 {
    color:#000;
    fill:#b9e0ff;
    fill-opacity:1;
    fill-rule:nonzero;
    stroke:none;
    stroke-width:1px;
    marker:none;
    visibility:visible;
    display:inline;
    overflow:visible;
    enable-background:accumulate
}
.wavedrom_svg_defs .s9 {
    fill:#000;
    fill-opacity:1;
    stroke:none
}
.wavedrom_svg_defs .s10 {
    color:#000;
    fill:#fff;
    fill-opacity:1;
    fill-rule:nonzero;
    stroke:none;
    stroke-width:1px;
    marker:none;
    visibility:visible;
    display:inline;
    overflow:visible;
    enable-background:accumulate
}
.wavedrom_svg_defs .s11 {
    fill:#0041c4;
    fill-opacity:1;
    stroke:none
}
.wavedrom_svg_defs .s12 {
    fill:none;
    stroke:#0041c4;
    stroke-width:1;
    stroke-linecap:round;
    stroke-linejoin:miter;
    stroke-miterlimit:4;
    stroke-opacity:1;
    stroke-dasharray:none
}

/*wavedrom stop*/

/* xsj patch start */

.xiaoshujiang_code .code_line_break_hack{
    margin:0;
    border:0;
    border-top:0;
    border-bottom:0;
}
.component_attachment, .code_line_break_hack{
  display: none;
  visibility: collapse!important;
  height: 0!important;
}

.blank_anchor_id {
    float: right;
    width: 1px
}
.blank_anchor_id {
    visibility: hidden;
}
.blank_anchor_id:before {
    content: 'a';
}
.xsj_foreignObject{
  width: 100%!important;
  height: 100%!important;
}
.xsj_foreignObject hr{
    margin: inherit;
}

/* xsj patch end */

</style>
</head><body>
<div><div class="preview" id="wmd-preview">

	<div class="preview html_preview xsj_export_zip"><h1 class="story_title">ScryInfo 协议层（简化版）SDK接口文档 v1.0</h1><div class="xiaoshujiang_element xsj_anchor">
  <a name="scrye58d8fe8aeaee5b182e4b89ae58aa1e6b581e7a88b_1" class="blank_anchor_name"></a><a id="scrye58d8fe8aeaee5b182e4b89ae58aa1e6b581e7a88b_1" class="blank_anchor_id"></a><a name="scry协议层业务流程" class="blank_anchor_name"></a><a id="scry协议层业务流程" class="blank_anchor_id"></a>
</div>
<h3 class="xsj_heading_h3"><span class="xsj_heading_content">Scry协议层业务流程</span></h3>
<p class="xsj_paragraph_level_0"></p><div class="xsj_remote_html story_remote_resource_block"><div>
  <div id="xsj_drawio_image"><img src="b523e3a5a2f372981331b7a6cce5cac8.png" name="b523e3a5a2f372981331b7a6cce5cac8.png"></div>
  <div id="xsj_drawio_xml" style="display:none;">&lt;mxfile userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.89 Safari/537.36" version="8.5.3" editor="www.draw.io" type="device"&gt;&lt;diagram&gt;7VrbbuM2EP0aA+3DGtbVyePGm2wf2kWwWaDNU0FLtMRaIlWKiu1+fYcUaV2oLRxUji/ZBEik4fA2nHNmhvbEW+TbzxwV6W8sxtnEncXbifdp4rqO74TwT0p2teTGvakFCSexVmoET+QfrIUzLa1IjMuOomAsE6ToCiNGKY5ER4Y4Z5uu2opl3VkLlGBL8BShzJb+TmKRamkY+E3DL5gkqZnaCW/rliWK1glnFdUTTlxvpX7q5hyZwfROyxTFbNMSefcTb8EZE/VTvl3gTBrX2K3u9/Cd1v3COabikA6uXobYmb3jGEyhXxkXKUsYRdl9I71T28NygBm8pSLP4NGBR7wl4g8pngb67bnV8og5ybHAXHeEFfJdS12+Prfb+h3+wkLstLOgSjAQNQv8lbFCT7ZiVDygnGTS+77BECXs8AvewN+vLEdUq+iRHDm5bTZtyZJVPNKW8bQnIp5grRXUImmzVjdt6s+YwfL5DhQ4zpAgL133QtpLk71ec1DwoM9q+Nz0Wl5QVulBn2BdwjrNUnC23jux2z0vcL5C6uXbROJ4usrYJkphmGkpB/tT6mxSIvBTgZQRNqA2soFfMBd4+5/G063hrcaMJpX57VSbf9PGqFZKW/C8GcHg/g+gHAyUwAbK/FRACWyggAKYCnZRLTNSpnLTMRJo4n2UDI3hSQvchXzCZRFxUgjCaKehAJZeyc5speXTiWTbMIM93y1hhjCRT4+WnopSGNpRLuFEl2WhTKt7dtws/LuSsUAdxIdSnYRcphMU26bRTKUHX3GU5HBApRkSjLQ0Ov1pAeBRKldE8lLF2XprcATwkqq/vBJpb5/j0AzME+GyPC+aCbo04xjaabGM6w+wjDOb/X93DX/QzME0M7dpxjlZQJ5bPHNX7Wqa4VhupAEX7CBFJW4zxYGAV+jtYf49YdFzD8TiGBHfZBIXgUWVsH2UpQ8IKKPYyB6I3OBZ4NUZyAuM3tsD1rEzA4NYwREtV5jXkF1jarDbD9iyAAVlqEBlkanAjnaEJgbqpU41ZLqAoCSE8Mk2NGMo3gdXlUXouPpTP37/PBJHvKuA7XtvSBLOjeVFXy6INk5NCfvbnTYljB7DVVcgR7RrKRSMqAx5P/KjFDRuNZ+7HbcKfaftGK/Vh4d6BY1b7bdyWDhyLE97PoanOS0/a7zu+57W8bPG7S4xQA15o++fKkC59oGbAEUxjk2MiXFEYh0AlpVciQpEdh1KZUh4GCsSyGlLWRKfcygIfPuGaDgUjFG6XVLtdhFwHLhwNQXyCeBoX7kumuyvULGlkyzq7G86Ug73FYuK0xrkigRSom6ucMFKIsaa5ZoTxdt5nx0GEkXvSOwwcBF5LyuCV5/auzqyPqGHJgt6E0KfH4XQX5dfOdeUX4Vvke0fjMjQJvSMyXu52Td5AQDErq78x0EXnFROKBKQnJ0TwPqcGIaHcuIYn6l5F5QxvQY8C5bJc4YNeY4vf48IKlOgdD6WPlmWZFYzULRYV18Ry4sMLDzpfep2veGsj7bB++xjoS10raO5pKuqSwhwwVCA806FxdCuWM7hxuiaMprBAz8Z+QZ2RrP/SCMldF3uqbfDtzNVSNoXRiu0xtd+Y9RnZN8bKDBGqgnhtfliX30D3Hx90rv/Fw==&lt;/diagram&gt;&lt;/mxfile&gt;</div>
</div><div class="component_attachment" style="display:none;">
<a class="attachment table_attachment" href="attachments/1552098289109.drawio.html" name="attachments/1552098289109.drawio.html" title="Diagram" data-size="64756">
  <i class="fa fa-paperclip"></i>
  <span class="filename">1552098289109.drawio.html</span>
  <span class="filesize">63.24KB</span>
</a>
</div></div><p></p>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e68ea5e58fa3_2" class="blank_anchor_name"></a><a id="e68ea5e58fa3_2" class="blank_anchor_id"></a><a name="接口" class="blank_anchor_name"></a><a id="接口" class="blank_anchor_id"></a>
</div>
<h3 class="xsj_heading_h3"><span class="xsj_heading_content">接口</span></h3>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="sdk_3" class="blank_anchor_name"></a><a id="sdk_3" class="blank_anchor_id"></a><a name="sdk" class="blank_anchor_name"></a><a id="sdk" class="blank_anchor_id"></a>
</div>
<h5 class="xsj_heading_h5"><span class="xsj_heading_content">Sdk</span></h5>
<p class="xsj_paragraph_level_0">Package: sdk</p>
<p class="xsj_paragraph_level_0"></p><div class="xsj_remote_html story_remote_resource_block"><table class="table table-celled table-component" border="1" style="border-collapse: collapse; width: 99.9471%;" id="tinymcetable"> <thead>
<tr>
<th style="width: 4.16079%; text-align: center;">seq</th>
<th style="width: 35.7446%; text-align: center;">definition</th>
<th style="width: 60.0417%; text-align: center;">functionality</th>
</tr>
</thead>
<tbody>
<tr>
<td style="width: 4.16079%;">1</td>
<td style="width: 35.7446%;">
<pre>Init(<br> ethNodeAddr string,<br> keyServiceAddr string,<br> protocolAddr string,<br> tokenAddr string,<br> fromBlock uint64,<br> ipfsNodeAddr string,<br> logPath string,<br> appId string,<br>) error</pre>
</td>
<td style="width: 60.0417%;">在使用scryinfo协议层SDK之前，需要对整个SDK进行初始化。<br><br>ethNodeAddr&nbsp; : 以太坊节点地址，由主办者提供<br>keyServiceAddr: 密钥服务地址，由主办者提供<br>protocolAddr&nbsp; &nbsp;: 协议智能合约的地址，由主办者提供<br>tokenAddr&nbsp; &nbsp; &nbsp;: token智能合约的地址，由主办者提供<br>fromBlock&nbsp; &nbsp; &nbsp;: event扫描的起始区块，默认为0，即从当前最新块开始扫描<br>ipfsNodeAddr&nbsp; : IPFS节点地址，由主办者提供<br>logPath&nbsp; &nbsp; &nbsp; &nbsp;: SDK日志存放全路径，包含文件名<br>appId&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 应用程序ID。同一ID下的消息是互通的，每个参赛团队应该有全局唯一的appId。</td>
</tr>
</tbody> </table><div class="component_attachment" style="display:none;">
<a class="attachment table_attachment" href="attachments/1552275406062.table.html" name="attachments/1552275406062.table.html" title="表格" data-size="1507">
  <i class="fa fa-paperclip"></i>
  <span class="filename">1552275406062.table.html</span>
  <span class="filesize">1.47KB</span>
</a>
</div></div><p></p>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="scryclient20-20scrye5aea2e688b7e7abafe6938de4bd9c_4" class="blank_anchor_name"></a><a id="scryclient20-20scrye5aea2e688b7e7abafe6938de4bd9c_4" class="blank_anchor_id"></a><a name="scryclient-scry客户端操作" class="blank_anchor_name"></a><a id="scryclient-scry客户端操作" class="blank_anchor_id"></a>
</div>
<h5 class="xsj_heading_h5"><span class="xsj_heading_content">ScryClient - Scry客户端操作</span></h5>
<p class="xsj_paragraph_level_0">Package: sdk/scryclient</p>
<p class="xsj_paragraph_level_0"></p><div class="xsj_remote_html story_remote_resource_block"><table class="table table-celled table-component" border="1" style="border-collapse: collapse; width: 99.7398%; height: 191px;" id="tinymcetable"> <thead>
<tr style="height: 20px;">
<th style="width: 2.99049%; height: 20px; text-align: center;">seq</th>
<th style="width: 35.7319%; height: 20px; text-align: center;">definition</th>
<th style="width: 61.0174%; height: 20px; text-align: center;">functionality</th>
</tr>
</thead>
<tbody>
<tr style="height: 20px;">
<td style="width: 2.99049%; height: 20px;">1</td>
<td style="width: 35.7319%; height: 20px;">
<pre>NewScryClient(<br>   address string<br>) (*ScryClient)</pre>
</td>
<td style="width: 61.0174%; height: 20px;">创建一个ScryClient实例(如名为scryClient)<br>用户访问scryClient.Account.Address能够得到用户的账户地址。<br><br>address: 待创建用户的地址</td>
</tr>
<tr style="height: 20px;">
<td style="width: 2.99049%; height: 20px;">2</td>
<td style="width: 35.7319%; height: 20px;">
<pre>SubscribeEvent(<br>   eventName string, <br>   callback chainevents.EventCallback)</pre>
</td>
<td style="width: 61.0174%; height: 20px;">当前ScryClient通过调用此接口，可订购链上此用户的指定事件(event)。当event到来时，会触发指定的callback函数。可以订购的event类型有：<br>
<pre>DataPublish<br>TransactionCreate<br>Buy<br>ReadyForDownload<br>TransactionClose<br>Approval</pre>
</td>
</tr>
<tr style="height: 20px;">
<td style="width: 2.99049%; height: 20px;">3</td>
<td style="width: 35.7319%; height: 20px;">
<pre>GetEth(<br>   owner common.Address<br>) (*big.Int, error)</pre>
</td>
<td style="width: 61.0174%; height: 20px;">获取账户地址为owner的ETH数额，单位为wei。<br><br>owner: 账户地址</td>
</tr>
<tr style="height: 51px;">
<td style="width: 2.99049%; height: 51px;">4</td>
<td style="width: 35.7319%; height: 51px;">
<pre>GetScryToken(<br>   owner common.Address<br>) (*big.Int, error)</pre>
</td>
<td style="width: 61.0174%; height: 51px;">获取账户地址为owner的Token数额，单位为1 token。<br><br>owner: 账户地址</td>
</tr>
</tbody> </table><div class="component_attachment" style="display:none;">
<a class="attachment table_attachment" href="attachments/1552112711362.table.html" name="attachments/1552112711362.table.html" title="表格" data-size="2154">
  <i class="fa fa-paperclip"></i>
  <span class="filename">1552112711362.table.html</span>
  <span class="filesize">2.10KB</span>
</a>
</div></div><p></p>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="contract20-20e59088e7baa6e6938de4bd9c_5" class="blank_anchor_name"></a><a id="contract20-20e59088e7baa6e6938de4bd9c_5" class="blank_anchor_id"></a><a name="contract-合约操作" class="blank_anchor_name"></a><a id="contract-合约操作" class="blank_anchor_id"></a>
</div>
<h5 class="xsj_heading_h5"><span class="xsj_heading_content">Contract - 合约操作</span></h5>
<p class="xsj_paragraph_level_0">Package: sdk/scryclient/chaininterfacewrapper</p>
<p class="xsj_paragraph_level_0"></p><div class="xsj_remote_html story_remote_resource_block"><table class="table table-celled table-component" border="1" style="border-collapse: collapse; width: 99.9471%; height: 532px;" id="tinymcetable"> <thead>
<tr style="height: 20px;">
<th style="width: 4.47117%; text-align: center; height: 20px;">seq</th>
<th style="width: 35.6682%; text-align: center; height: 20px;">definition</th>
<th style="width: 59.8078%; text-align: center; height: 20px;">functionality</th>
</tr>
</thead>
<tbody>
<tr style="height: 89px;">
<td style="width: 4.47117%; height: 89px;">1</td>
<td style="width: 35.6682%; height: 89px;">
<pre>Publish(<br>   txParams *op.TransactParams,<br>   price *big.Int,<br>   metaData []byte,<br>   proofDatas [][]byte,<br>   proofNum int,<br>   descriptionData []byte<br>) (string, error)</pre>
</td>
<td style="width: 59.8078%; height: 89px;">发布数据到IPFS上，并将IPFS返回的资源id保存到区块链合约中。<br><br>该接口第一个返回值为publishId，类型为string。<br>txParams&nbsp; &nbsp; &nbsp; : 区块链交易参数。&nbsp;<br>price&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 数据售价，单位为1 token<br>metaData&nbsp; &nbsp; &nbsp; : 待售数据<br>proofDatas&nbsp; &nbsp; &nbsp;: 数据证明片段，用来证明所发布的数据的真实性&nbsp;<br>proofNum&nbsp; &nbsp; &nbsp; :&nbsp;数据证明片段的数组大小&nbsp;<br>descriptionData : 数据描述，如title, keyword等。具体意义由应用层决定。<br><br>当数据成功发布到IPFS和区块链上，链会发送DataPublish事件给所有用户。<br>DataPublish事件以Json格式定义，参见Event接口</td>
</tr>
<tr style="height: 146px;">
<td style="width: 4.47117%; height: 154px;">2</td>
<td style="width: 35.6682%; height: 154px;">
<pre>ApproveTransfer(<br>   txParams *op.TransactParams,<br>   spender common.Address, <br>   value *big.Int<br>) (error)</pre>
</td>
<td style="width: 59.8078%; height: 154px;">准许地址spender从本接口调用方地址进行token转账，<br><br>txParams&nbsp; &nbsp;: 区块链交易参数<br>spender&nbsp; &nbsp; : 被允许的转账发起地址<br>value&nbsp; &nbsp; &nbsp; : 被允许的转账额度,&nbsp;单位为1 token，要大于或等于想购买的数据价格<br><br><br>在这个过程中，链收到请求后，会发送Approval事件给调用方。参见Event接口。</td>
</tr>
<tr style="height: 20px;">
<td style="width: 4.47117%; height: 20px;">3</td>
<td style="width: 35.6682%; height: 20px;">
<pre>PrepareToBuy(<br>   txParams *op.TransactParams,<br>   publishId string<br>) (error)</pre>
</td>
<td style="width: 59.8078%; height: 20px;">买方准备购买数据，希望得到待买数据的证明数据ID。<br>在调用本接口之前，买方需先调用ApproveTransfer接口，允许合约从买方地址转出押金。<br><br>txParams&nbsp; &nbsp;: 区块链交易参数<br>publishId&nbsp; &nbsp;: 同上<br><br>链收到请求后，会发送TransactionCreate事件给买方。<br>TransactionCreate事件以Json格式定义，参见Event接口。</td>
</tr>
<tr style="height: 20px;">
<td style="width: 4.47117%; height: 20px;">4<br><br></td>
<td style="width: 35.6682%; height: 20px;">
<pre>BuyData(<br>   txParams *op.TransactParams,<br>   txId *big.Int<br>) (error)</pre>
</td>
<td style="width: 59.8078%; height: 20px;">买方正式购买数据。<br><br>txParams&nbsp; &nbsp;: 区块链交易参数<br>txId&nbsp; &nbsp; &nbsp; &nbsp; : 本次交易ID，由TransactionCreate事件的transactionId字段取得。<br><br>链收到请求后，会发送Buy事件给卖方。<br>Buy事件以Json格式定义，参见Event接口。</td>
</tr>
<tr style="height: 89px;">
<td style="width: 4.47117%; height: 89px;">5</td>
<td style="width: 35.6682%; height: 89px;">
<pre>SubmitMetaDataIdEncWithBuyer(<br>   txParams *op.TransactParams,<br>   txId *big.Int,<br>   encyptedMetaDataId []byte<br>) (error)</pre>
</td>
<td style="width: 59.8078%; height: 89px;">卖方上传待卖数据的metaDataId到区块链上，该ID使用买方公钥加密。<br><br>txParams&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 区块链交易参数<br>txId&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 本次交易ID，由Buy事件的transactionId字段取得<br>encyptedMetaDataId : 使用买方公钥加密的metaDataId<br><br>链收到请求后，会发送ReadyForDownload事件给买方。<br>买方得到metaDataId并以私钥解密，得到真正的meta data ID，就可以从IPFS上下载数据了。<br>ReadyForDownload事件以Json格式定义，参见Event接口。</td>
</tr>
<tr style="height: 70px;">
<td style="width: 4.47117%; height: 70px;">6</td>
<td style="width: 35.6682%; height: 70px;">
<pre>ConfirmDataTruth(<br>   txParams *op.TransactParams,<br>   txId *big.Int, <br>   truth bool<br>) (error)</pre>
</td>
<td style="width: 59.8078%; height: 70px;">买方确认数据真实性。<br><br>txParams&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 区块链交易参数<br>txId&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 本次交易ID，由Buy事件的transactionId字段取得<br>truth&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 数据是否真实<br><br>链收到请求后，会发送TransactionClose事件给所有用户，并关闭交易。<br>若数据为真，合约会将买方押金支付给卖方。<br>TransactionClose事件以Json格式定义，参见Event接口。</td>
</tr>
<tr>
<td style="width: 4.47117%;">7</td>
<td style="width: 35.6682%;">
<pre>Bytes32ToIpfsHash(<br>   value [32]byte<br>) (string, error)</pre>
</td>
<td style="width: 59.8078%;">工具函数，用来把bytes32转换为base58编码的IPFS Hash。<br><br><br></td>
</tr>
</tbody> </table><div class="component_attachment" style="display:none;">
<a class="attachment table_attachment" href="attachments/1552116179330.table.html" name="attachments/1552116179330.table.html" title="表格" data-size="5792">
  <i class="fa fa-paperclip"></i>
  <span class="filename">1552116179330.table.html</span>
  <span class="filesize">5.66KB</span>
</a>
</div></div><p></p>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="key20manager20-20e5af86e992a5e7aea1e79086e68ea5e58fa3_6" class="blank_anchor_name"></a><a id="key20manager20-20e5af86e992a5e7aea1e79086e68ea5e58fa3_6" class="blank_anchor_id"></a><a name="key-manager-密钥管理接口" class="blank_anchor_name"></a><a id="key-manager-密钥管理接口" class="blank_anchor_id"></a>
</div>
<h5 class="xsj_heading_h5"><span class="xsj_heading_content">Key Manager - 密钥管理接口</span></h5>
<p class="xsj_paragraph_level_0">Package: sdk/util/accounts</p>
<p class="xsj_paragraph_level_0"></p><div class="xsj_remote_html story_remote_resource_block"><table class="table table-celled table-component" border="1" style="border-collapse: collapse; width: 100.121%;" id="tinymcetable"> <thead>
<tr>
<th style="width: 2.99246%; text-align: center;">seq</th>
<th style="width: 35.6258%; text-align: center;">definition</th>
<th style="width: 61.5023%; text-align: center;">functionality</th>
</tr>
</thead>
<tbody>
<tr>
<td style="width: 2.99246%;">1</td>
<td style="width: 35.6258%;">
<pre>Encrypt(<br>    plainText []byte, <br>    address string) <br>([]byte, error)</pre>
</td>
<td style="width: 61.5023%;">使用用户地址为address的公钥对明文plainText进行加密<br><br>plainText: 明文数据&nbsp;<br>address : 用户地址</td>
</tr>
<tr>
<td style="width: 2.99246%;">2</td>
<td style="width: 35.6258%;">
<pre>Decrypt(<br>    cipherText []byte,<br>    address string,<br>    password string)<br>([]byte, error)</pre>
</td>
<td style="width: 61.5023%;">使用用户地址为address的私钥对密文cipherText进行解密<br><br>cipherText : 密文<br>address&nbsp; &nbsp;: 用户地址<br>password&nbsp; : 用户密码</td>
</tr>
<tr>
<td style="width: 2.99246%;">3</td>
<td style="width: 35.6258%;">
<pre>ReEncrypt(<br>    cipherText []byte, <br>    address1 string,<br>   address2 string, <br>    password string) <br>([]byte, error)</pre>
</td>
<td style="width: 61.5023%;">对已加密数据cipherText进行解密，然后再使用第二个用户地址的公钥进行加密。<br><br>cipherText: 密文数据&nbsp;<br>address1 : 解密用户地址<br>address2 : 加密用户地址<br>password:&nbsp; 解密用户密码</td>
</tr>
</tbody> </table><div class="component_attachment" style="display:none;">
<a class="attachment table_attachment" href="attachments/1552269049817.table.html" name="attachments/1552269049817.table.html" title="表格" data-size="1662">
  <i class="fa fa-paperclip"></i>
  <span class="filename">1552269049817.table.html</span>
  <span class="filesize">1.62KB</span>
</a>
</div></div><p></p>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="event20-20e59088e7baa6e4ba8be4bbb6_7" class="blank_anchor_name"></a><a id="event20-20e59088e7baa6e4ba8be4bbb6_7" class="blank_anchor_id"></a><a name="event-合约事件" class="blank_anchor_name"></a><a id="event-合约事件" class="blank_anchor_id"></a>
</div>
<h5 class="xsj_heading_h5"><span class="xsj_heading_content">Event - 合约事件</span></h5>
<p class="xsj_paragraph_level_0">所有的Event都以JSON格式进行传输。</p>
<p class="xsj_paragraph_level_0"></p><div class="xsj_remote_html story_remote_resource_block"><table class="table table-celled table-component" border="1" style="border-collapse: collapse; width: 100.029%; height: 140px;" id="tinymcetable"> <thead>
<tr style="height: 20px;">
<th style="width: 1.92175%; height: 20px;">seq</th>
<th style="width: 13.3911%; height: 20px;">event name</th>
<th style="width: 84.7161%; height: 20px;">example</th>
</tr>
</thead>
<tbody>
<tr style="height: 20px;">
<td style="width: 1.92175%; height: 20px;">1</td>
<td style="width: 13.3911%; height: 20px;">DataPublish</td>
<td style="width: 84.7161%; height: 20px;">{<br>"despDataId":"QmhKnroYBFp", //数据描述ID，依据此ID可从IPFS取得待售数据的描述<br>"price":1000,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//待售数据价格<br>"publishId":"155212056",&nbsp; &nbsp; &nbsp; &nbsp;//本次发布的ID，与Publish()第一个返回值相同<br>"seqNo":"155212057",&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>"users":["0xxxx"]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br>}</td>
</tr>
<tr style="height: 20px;">
<td style="width: 1.92175%; height: 20px;">2</td>
<td style="width: 13.3911%; height: 20px;">Approval</td>
<td style="width: 84.7161%; height: 20px;">{<br>"owner":"0x3Ab0dAA324",&nbsp; &nbsp; &nbsp; //授权人<br>"spender":"0x3c4d26E91",&nbsp; &nbsp; &nbsp; //被授权人<br>"value":1600&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //已授权额度<br>}</td>
</tr>
<tr style="height: 20px;">
<td style="width: 1.92175%; height: 20px;">3</td>
<td style="width: 13.3911%; height: 20px;">TransactionCreate</td>
<td style="width: 84.7161%; height: 20px;">{&nbsp;<br>"proofIds":[[211,159],[170,49]],&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//证明数据ID<br>"publishId":"1552121",&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //数据发布ID<br>"seqNo":"15521219",<br>"transactionId":4,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //本次交易ID<br>"users":["0xxxx"]<br>}</td>
</tr>
<tr style="height: 20px;">
<td style="width: 1.92175%; height: 20px;">4</td>
<td style="width: 13.3911%; height: 20px;">Buy</td>
<td style="width: 84.7161%; height: 20px;">{<br>"metaDataIdEncSeller":"SdWeISqpSyhGA==",&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //使用卖方公钥加密的元数据ID<br>"publishId":"1552121827295982593-913139",&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//数据发布ID<br>"seqNo":"1552121924035218179-67679122",<br>"transactionId":4,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//本次交易ID<br>"buyer","0x3Ab0dAA324"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //买方地址<br>"users":["0xxxx"]<br>}</td>
</tr>
<tr style="height: 20px;">
<td style="width: 1.92175%; height: 20px;">5</td>
<td style="width: 13.3911%; height: 20px;">ReadyForDownload</td>
<td style="width: 84.7161%; height: 20px;">{<br>"metaDataIdEncBuyer":"tql/mAZY/z0aR2g==",&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//使用买方公钥加密的元数据ID<br>"seqNo":"1552126832692923243-89400636",<br>"transactionId":4,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //本次交易ID<br>"users":["0xxxx"]<br>}</td>
</tr>
<tr style="height: 20px;">
<td style="width: 1.92175%; height: 20px;">6</td>
<td style="width: 13.3911%; height: 20px;">TransactionClose</td>
<td style="width: 84.7161%; height: 20px;">{<br>"seqNo":"1552126873209063970-5512851552272651527",<br>"transactionId":4,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//本次交易ID<br>"users":["0xxxx"]<br>}</td>
</tr>
</tbody> </table><div class="component_attachment" style="display:none;">
<a class="attachment table_attachment" href="attachments/1552267409890.table.html" name="attachments/1552267409890.table.html" title="表格" data-size="4333">
  <i class="fa fa-paperclip"></i>
  <span class="filename">1552267409890.table.html</span>
  <span class="filesize">4.23KB</span>
</a>
</div></div><p></p>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e4be8be7a88b_8" class="blank_anchor_name"></a><a id="e4be8be7a88b_8" class="blank_anchor_id"></a><a name="例程" class="blank_anchor_name"></a><a id="例程" class="blank_anchor_id"></a>
</div>
<h3 class="xsj_heading_h3"><span class="xsj_heading_content">例程</span></h3>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e8b083e794a8sdke79a84e7acace4b880e6ada5efbc9ae5889de5a78be58c96sdk_9" class="blank_anchor_name"></a><a id="e8b083e794a8sdke79a84e7acace4b880e6ada5efbc9ae5889de5a78be58c96sdk_9" class="blank_anchor_id"></a><a name="调用sdk的第一步初始化sdk" class="blank_anchor_name"></a><a id="调用sdk的第一步初始化sdk" class="blank_anchor_id"></a>
</div>
<h5 class="xsj_heading_h5"><span class="xsj_heading_content">调用SDK的第一步：初始化SDK</span></h5>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {	&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>    wd, _ := os.Getwd()&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>    err := sdk.Init(&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>        <span class="hljs-string">"http://192.168.1.12:8545/"</span>,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>        <span class="hljs-string">"192.168.1.6:48080"</span>,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>        protocolContractAddr,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>        tokenContractAddr,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>        <span class="hljs-number">0</span>,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>        <span class="hljs-string">"/ip4/192.168.1.6/tcp/5001"</span>,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span>        wd+<span class="hljs-string">"/testconsole.log"</span>,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span>        <span class="hljs-string">"scryapp1"</span>)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="12"><span class="li_linenum_before_span li_linenum_before_span_hide">12</span>        &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="13"><span class="li_linenum_before_span li_linenum_before_span_hide">13</span>    ......&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="14"><span class="li_linenum_before_span li_linenum_before_span_hide">14</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e7acace4ba8ce6ada5efbc9ae5889be5bbbae794a8e688b7e5ae9ee4be8b_10" class="blank_anchor_name"></a><a id="e7acace4ba8ce6ada5efbc9ae5889be5bbbae794a8e688b7e5ae9ee4be8b_10" class="blank_anchor_id"></a><a name="第二步创建用户实例" class="blank_anchor_name"></a><a id="第二步创建用户实例" class="blank_anchor_id"></a>
</div>
<h5 class="xsj_heading_h5"><span class="xsj_heading_content">第二步：创建用户实例</span></h5>
<p class="xsj_paragraph_level_0">系统预先生成了用户账户，该账户内包含ETH和token，到时候会分配给各团队<br>
用户需要根据分配的账户地址生成用户实例。</p>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span>seller := scryclient.NewScryClient(address)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>buyer := scryclient.NewScryClient(address)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span><span class="hljs-comment">//订购事件</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>seller.SubscribeEvent(<span class="hljs-string">"DataPublish"</span>, onPublish)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>seller.SubscribeEvent(<span class="hljs-string">"Buy"</span>, onPurchase)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>seller.SubscribeEvent(<span class="hljs-string">"TransactionCreate"</span>, onTransactionCreate)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>seller.SubscribeEvent(<span class="hljs-string">"TransactionClose"</span>, onClose)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span><span class="hljs-comment">//买方若收到onApprovalBuyerTransfer通知，表明approve成功</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span>buyer.SubscribeEvent(<span class="hljs-string">"Approval"</span>, onApprovalBuyerTransfer)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="12"><span class="li_linenum_before_span li_linenum_before_span_hide">12</span>buyer.SubscribeEvent(<span class="hljs-string">"TransactionCreate"</span>, onTransactionCreate)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="13"><span class="li_linenum_before_span li_linenum_before_span_hide">13</span>buyer.SubscribeEvent(<span class="hljs-string">"ReadyForDownload"</span>, onReadyForDownload)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="14"><span class="li_linenum_before_span li_linenum_before_span_hide">14</span>buyer.SubscribeEvent(<span class="hljs-string">"TransactionClose"</span>, onClose)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e4b88be99da2e58fafe4bba5e5bc80e5a78be4baa4e69893e4ba86_11" class="blank_anchor_name"></a><a id="e4b88be99da2e58fafe4bba5e5bc80e5a78be4baa4e69893e4ba86_11" class="blank_anchor_id"></a><a name="下面可以开始交易了" class="blank_anchor_name"></a><a id="下面可以开始交易了" class="blank_anchor_id"></a>
</div>
<h5 class="xsj_heading_h5"><span class="xsj_heading_content">下面可以开始交易了</span></h5>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e58d96e696b9e58f91e5b883e695b0e68dae_12" class="blank_anchor_name"></a><a id="e58d96e696b9e58f91e5b883e695b0e68dae_12" class="blank_anchor_id"></a><a name="卖方发布数据" class="blank_anchor_name"></a><a id="卖方发布数据" class="blank_anchor_id"></a>
</div>
<h6 class="xsj_heading_h6"><span class="xsj_heading_content">卖方发布数据</span></h6>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SellerPublishData</span><span class="hljs-params">(supportVerify <span class="hljs-keyword">bool</span>)</span></span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>    <span class="hljs-comment">//待发布的元数据</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>    metaData := []<span class="hljs-keyword">byte</span>(<span class="hljs-string">"magic meta data test"</span>)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>    <span class="hljs-comment">//一些元数据片段: 用以证明元数据的真实性</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>    proofData := [][]<span class="hljs-keyword">byte</span>{{<span class="hljs-string">'4'</span>, <span class="hljs-string">'5'</span>, <span class="hljs-string">'6'</span>, <span class="hljs-string">'3'</span>}, {<span class="hljs-string">'2'</span>, <span class="hljs-string">'2'</span>, <span class="hljs-string">'1'</span>}}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>    <span class="hljs-comment">//元数据的描述数据</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>    despData := []<span class="hljs-keyword">byte</span>{<span class="hljs-string">'7'</span>, <span class="hljs-string">'8'</span>, <span class="hljs-string">'9'</span>, <span class="hljs-string">'3'</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span>    txParam := chainoperations.TransactParams{&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="12"><span class="li_linenum_before_span li_linenum_before_span_hide">12</span>        From: common.HexToAddress(seller.Account.Address),&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="13"><span class="li_linenum_before_span li_linenum_before_span_hide">13</span>        Password: keyPassword,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="14"><span class="li_linenum_before_span li_linenum_before_span_hide">14</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="15"><span class="li_linenum_before_span li_linenum_before_span_hide">15</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="16"><span class="li_linenum_before_span li_linenum_before_span_hide">16</span>    cif.Publish(&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="17"><span class="li_linenum_before_span li_linenum_before_span_hide">17</span>        &amp;txParam,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="18"><span class="li_linenum_before_span li_linenum_before_span_hide">18</span>        big.NewInt(<span class="hljs-number">1000</span>),&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="19"><span class="li_linenum_before_span li_linenum_before_span_hide">19</span>        metaData,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="20"><span class="li_linenum_before_span li_linenum_before_span_hide">20</span>        proofData,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="21"><span class="li_linenum_before_span li_linenum_before_span_hide">21</span>        <span class="hljs-number">2</span>,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="22"><span class="li_linenum_before_span li_linenum_before_span_hide">22</span>        despData,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="23"><span class="li_linenum_before_span li_linenum_before_span_hide">23</span>    )&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="24"><span class="li_linenum_before_span li_linenum_before_span_hide">24</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e4b9b0e696b9e694b6e588b0e695b0e68daee58f91e5b883e9809ae79fa5efbc8ce58f96e588b0e695b0e68daee79a84e68f8fe8bfb0e695b0e68daeidefbc8ce68daee6ada4e4b9b0e696b9e58fafe4bba5e4bb8eipfse4b88ae4b88be8bdbde695b0e68daee68f8fe8bfb0e4bfa1e681af_13" class="blank_anchor_name"></a><a id="e4b9b0e696b9e694b6e588b0e695b0e68daee58f91e5b883e9809ae79fa5efbc8ce58f96e588b0e695b0e68daee79a84e68f8fe8bfb0e695b0e68daeidefbc8ce68daee6ada4e4b9b0e696b9e58fafe4bba5e4bb8eipfse4b88ae4b88be8bdbde695b0e68daee68f8fe8bfb0e4bfa1e681af_13" class="blank_anchor_id"></a><a name="买方收到数据发布通知取到数据的描述数据id据此买方可以从ipfs上下载数据描述信息" class="blank_anchor_name"></a><a id="买方收到数据发布通知取到数据的描述数据id据此买方可以从ipfs上下载数据描述信息" class="blank_anchor_id"></a>
</div>
<h6 class="xsj_heading_h6"><span class="xsj_heading_content">买方收到数据发布通知，取到数据的描述数据ID，据此买方可以从IPFS上下载数据描述信息</span></h6>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onPublish</span><span class="hljs-params">(event events.Event)</span> <span class="hljs-title">bool</span></span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>   <span class="hljs-comment">//数据的发布ID</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>    publishId = event.Data.Get(<span class="hljs-string">"publishId"</span>).(<span class="hljs-keyword">string</span>)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>    <span class="hljs-comment">//描述数据ID</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>    despDataId := event.Data.Get(<span class="hljs-string">"despDataId"</span>).(<span class="hljs-keyword">string</span>)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>    <span class="hljs-comment">//价格</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>    price := event.Data.Get(<span class="hljs-string">"price"</span>).(*big.Int)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e79c8be588b0e695b0e68daee68f8fe8bfb0e4bfa1e681afe5908eefbc8ce4b9b0e696b9e5afb9e8afa5e695b0e68daee5be88e6849fe585b4e8b6a3efbc8ce4ba8ee698afe8aebee5ae9ae5be85e694afe4bb98e68abce98791e9a29de5baa6efbc8ce58581e8aeb8e58d8fe8aeaee5b182e699bae883bde59088e7baa6e4bb8ee585b6e8b4a6e688b7e8bdace7a7bbtokene794a8e4bd9ce68abce98791_14" class="blank_anchor_name"></a><a id="e79c8be588b0e695b0e68daee68f8fe8bfb0e4bfa1e681afe5908eefbc8ce4b9b0e696b9e5afb9e8afa5e695b0e68daee5be88e6849fe585b4e8b6a3efbc8ce4ba8ee698afe8aebee5ae9ae5be85e694afe4bb98e68abce98791e9a29de5baa6efbc8ce58581e8aeb8e58d8fe8aeaee5b182e699bae883bde59088e7baa6e4bb8ee585b6e8b4a6e688b7e8bdace7a7bbtokene794a8e4bd9ce68abce98791_14" class="blank_anchor_id"></a><a name="看到数据描述信息后买方对该数据很感兴趣于是设定待支付押金额度允许协议层智能合约从其账户转移token用作押金" class="blank_anchor_name"></a><a id="看到数据描述信息后买方对该数据很感兴趣于是设定待支付押金额度允许协议层智能合约从其账户转移token用作押金" class="blank_anchor_id"></a>
</div>
<h6 class="xsj_heading_h6"><span class="xsj_heading_content">看到数据描述信息后，买方对该数据很感兴趣，于是设定待支付押金额度，允许协议层智能合约从其账户转移Token用作押金</span></h6>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BuyerApproveTransfer</span><span class="hljs-params">()</span></span> {   &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>    <span class="hljs-comment">//buyerPassword: 买方账户密码</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>    txParam := chainoperations.TransactParams{&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>        From: common.HexToAddress(buyer.Account.Address),&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>        Password: buyerPassword,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>    &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>    <span class="hljs-comment">//protocolContractAddr是协议层合约地址</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span>    <span class="hljs-comment">//押金数额要大于等于数据价格,否则购买操作会失败	</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span>    err := cif.ApproveTransfer(&amp;txParam,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="12"><span class="li_linenum_before_span li_linenum_before_span_hide">12</span>        common.HexToAddress(protocolContractAddr),&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="13"><span class="li_linenum_before_span li_linenum_before_span_hide">13</span>        big.NewInt(<span class="hljs-number">1000</span>))&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="14"><span class="li_linenum_before_span li_linenum_before_span_hide">14</span>        &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="15"><span class="li_linenum_before_span li_linenum_before_span_hide">15</span>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="16"><span class="li_linenum_before_span li_linenum_before_span_hide">16</span>        fmt.Println(<span class="hljs-string">"BuyerApproveTransfer:"</span>, err)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="17"><span class="li_linenum_before_span li_linenum_before_span_hide">17</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="18"><span class="li_linenum_before_span li_linenum_before_span_hide">18</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e4b9b0e696b9e58786e5a487e8b4ade4b9b0efbc8ce699bae883bde59088e7baa6e4bb8ee4b9b0e696b9e8b4a6e688b7e689a3e999a4tokene68abce98791_15" class="blank_anchor_name"></a><a id="e4b9b0e696b9e58786e5a487e8b4ade4b9b0efbc8ce699bae883bde59088e7baa6e4bb8ee4b9b0e696b9e8b4a6e688b7e689a3e999a4tokene68abce98791_15" class="blank_anchor_id"></a><a name="买方准备购买智能合约从买方账户扣除token押金" class="blank_anchor_name"></a><a id="买方准备购买智能合约从买方账户扣除token押金" class="blank_anchor_id"></a>
</div>
<h6 class="xsj_heading_h6"><span class="xsj_heading_content">买方准备购买，智能合约从买方账户扣除token押金</span></h6>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrepareToBuy</span><span class="hljs-params">(publishId <span class="hljs-keyword">string</span>)</span></span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>    txParam := chainoperations.TransactParams{&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>        From: common.HexToAddress(buyer.Account.Address),&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>        Password: buyPassword,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>    &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>    err := cif.PrepareToBuy(&amp;txParam, publishId)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>        fmt.Println(<span class="hljs-string">"failed to prepareToBuy, error:"</span>, err)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e58d96e696b9e5be97e588b0transaction20id_16" class="blank_anchor_name"></a><a id="e58d96e696b9e5be97e588b0transaction20id_16" class="blank_anchor_id"></a><a name="卖方得到transaction-id" class="blank_anchor_name"></a><a id="卖方得到transaction-id" class="blank_anchor_id"></a>
</div>
<h6 class="xsj_heading_h6"><span class="xsj_heading_content">卖方得到transaction id</span></h6>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onTransactionCreate</span><span class="hljs-params">(event events.Event)</span> <span class="hljs-title">bool</span></span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>    fmt.Println(<span class="hljs-string">"seller: onTransactionCreated:"</span>, event)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>    &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>    <span class="hljs-comment">//本次交易ID</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>    txId = event.Data.Get(<span class="hljs-string">"transactionId"</span>).(*big.Int)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e4b9b0e696b9e5be97e588b0e695b0e68daee8af81e6988eidefbc8ce587ade5809fe8bf99e4ba9bidefbc8ce4b9b0e696b9e58fafe4bba5e4bb8eipfse4b88ae4b88be8bdbde8bf99e4ba9be8af81e6988eefbc8ce588a4e696ade695b0e68daee698afe4b88de698afe887aae5b7b1e683b3e8a681e79a84_17" class="blank_anchor_name"></a><a id="e4b9b0e696b9e5be97e588b0e695b0e68daee8af81e6988eidefbc8ce587ade5809fe8bf99e4ba9bidefbc8ce4b9b0e696b9e58fafe4bba5e4bb8eipfse4b88ae4b88be8bdbde8bf99e4ba9be8af81e6988eefbc8ce588a4e696ade695b0e68daee698afe4b88de698afe887aae5b7b1e683b3e8a681e79a84_17" class="blank_anchor_id"></a><a name="买方得到数据证明id凭借这些id买方可以从ipfs上下载这些证明判断数据是不是自己想要的" class="blank_anchor_name"></a><a id="买方得到数据证明id凭借这些id买方可以从ipfs上下载这些证明判断数据是不是自己想要的" class="blank_anchor_id"></a>
</div>
<h6 class="xsj_heading_h6"><span class="xsj_heading_content">买方得到数据证明ID，凭借这些ID，买方可以从IPFS上下载这些证明，判断数据是不是自己想要的</span></h6>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onTransactionCreate</span><span class="hljs-params">(event events.Event)</span> <span class="hljs-title">bool</span></span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>    <span class="hljs-comment">//本次交易ID</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>    txId = event.Data.Get(<span class="hljs-string">"transactionId"</span>).(*big.Int)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>    &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>    <span class="hljs-comment">//数据证明IDs</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>    proofIDs := event.Data.Get(<span class="hljs-string">"proofIds"</span>).([][<span class="hljs-number">32</span>]<span class="hljs-keyword">byte</span>)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e4b9b0e696b9e586b3e5ae9ae6ada3e5bc8fe8b4ade4b9b0e695b0e68dae_18" class="blank_anchor_name"></a><a id="e4b9b0e696b9e586b3e5ae9ae6ada3e5bc8fe8b4ade4b9b0e695b0e68dae_18" class="blank_anchor_id"></a><a name="买方决定正式购买数据" class="blank_anchor_name"></a><a id="买方决定正式购买数据" class="blank_anchor_id"></a>
</div>
<h6 class="xsj_heading_h6"><span class="xsj_heading_content">买方决定正式购买数据</span></h6>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Buy</span><span class="hljs-params">(txId *big.Int)</span></span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>    <span class="hljs-comment">//卖方需要订购Buy事件，这样才能收到买方的购买消息</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>    seller.SubscribeEvent(<span class="hljs-string">"Buy"</span>, onPurchase)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>    <span class="hljs-comment">//buyerPassword是买方账户密码</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>    txParam := chainoperations.TransactParams{&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>        From: common.HexToAddress(buyer.Account.Address),&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>        Password: buyerPassword,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span>    &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span>    <span class="hljs-comment">//txId为本次交易ID</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="12"><span class="li_linenum_before_span li_linenum_before_span_hide">12</span>    err := cif.BuyData(&amp;txParam, txId)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="13"><span class="li_linenum_before_span li_linenum_before_span_hide">13</span>    &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="14"><span class="li_linenum_before_span li_linenum_before_span_hide">14</span>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="15"><span class="li_linenum_before_span li_linenum_before_span_hide">15</span>        fmt.Println(<span class="hljs-string">"failed to buyData, error:"</span>, err)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="16"><span class="li_linenum_before_span li_linenum_before_span_hide">16</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="17"><span class="li_linenum_before_span li_linenum_before_span_hide">17</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e58d96e696b9e694b6e588b0e8b4ade4b9b0e695b0e68daee79a84e9809ae79fa5efbc8ce7949fe68890e4bdbfe794a8e4b9b0e696b9e585ace992a5e58aa0e5af86e79a84meta20data20idefbc8ce58f91e7bb99e59088e7baa6_19" class="blank_anchor_name"></a><a id="e58d96e696b9e694b6e588b0e8b4ade4b9b0e695b0e68daee79a84e9809ae79fa5efbc8ce7949fe68890e4bdbfe794a8e4b9b0e696b9e585ace992a5e58aa0e5af86e79a84meta20data20idefbc8ce58f91e7bb99e59088e7baa6_19" class="blank_anchor_id"></a><a name="卖方收到购买数据的通知生成使用买方公钥加密的meta-data-id发给合约" class="blank_anchor_name"></a><a id="卖方收到购买数据的通知生成使用买方公钥加密的meta-data-id发给合约" class="blank_anchor_id"></a>
</div>
<h6 class="xsj_heading_h6"><span class="xsj_heading_content">卖方收到购买数据的通知，生成使用买方公钥加密的meta data id，发给合约</span></h6>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onPurchase</span><span class="hljs-params">(event events.Event)</span> <span class="hljs-title">bool</span></span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>    fmt.Println(<span class="hljs-string">"onPurchase:"</span>, event)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>    &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>    <span class="hljs-comment">//使用卖方公钥加密的meta data id</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>    metaDataIdEncWithSeller = event.Data.Get(<span class="hljs-string">"metaDataIdEncSeller"</span>).([]<span class="hljs-keyword">byte</span>)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>    <span class="hljs-comment">//买方地址</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>    buyerAddr := event.Data.Get(<span class="hljs-string">"buyer"</span>).(common.Address)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>    <span class="hljs-keyword">var</span> err error&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span>    <span class="hljs-comment">//metaDataIdEncWithBuyer： 使用买方公钥加密的meta data id</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span>    <span class="hljs-comment">//metaDataIdEncWithSeller: 用卖方公钥加密的meta data id</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="12"><span class="li_linenum_before_span li_linenum_before_span_hide">12</span>    <span class="hljs-comment">//sellerPassword: 卖家密码</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="13"><span class="li_linenum_before_span li_linenum_before_span_hide">13</span>    metaDataIdEncWithBuyer, err = accounts.GetAMInstance().ReEncrypt(&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="14"><span class="li_linenum_before_span li_linenum_before_span_hide">14</span>        metaDataIdEncWithSeller,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="15"><span class="li_linenum_before_span li_linenum_before_span_hide">15</span>        seller.Account.Address,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="16"><span class="li_linenum_before_span li_linenum_before_span_hide">16</span>        buyerAddr.String(),&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="17"><span class="li_linenum_before_span li_linenum_before_span_hide">17</span>        clientPassword,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="18"><span class="li_linenum_before_span li_linenum_before_span_hide">18</span>    )&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="19"><span class="li_linenum_before_span li_linenum_before_span_hide">19</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="20"><span class="li_linenum_before_span li_linenum_before_span_hide">20</span>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="21"><span class="li_linenum_before_span li_linenum_before_span_hide">21</span>        fmt.Println(<span class="hljs-string">"failed to ReEncrypt meta data id with buyer's public key"</span>)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="22"><span class="li_linenum_before_span li_linenum_before_span_hide">22</span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="23"><span class="li_linenum_before_span li_linenum_before_span_hide">23</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="24"><span class="li_linenum_before_span li_linenum_before_span_hide">24</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="25"><span class="li_linenum_before_span li_linenum_before_span_hide">25</span>    SubmitMetaDataIdEncWithBuyer(txId)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="26"><span class="li_linenum_before_span li_linenum_before_span_hide">26</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="27"><span class="li_linenum_before_span li_linenum_before_span_hide">27</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="28"><span class="li_linenum_before_span li_linenum_before_span_hide">28</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="29"><span class="li_linenum_before_span li_linenum_before_span_hide">29</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="30"><span class="li_linenum_before_span li_linenum_before_span_hide">30</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SubmitMetaDataIdEncWithBuyer</span><span class="hljs-params">(txId *big.Int)</span></span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="31"><span class="li_linenum_before_span li_linenum_before_span_hide">31</span>    <span class="hljs-comment">//买方需要监听ReadyForDownload事件</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="32"><span class="li_linenum_before_span li_linenum_before_span_hide">32</span>    txParam := chainoperations.TransactParams{&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="33"><span class="li_linenum_before_span li_linenum_before_span_hide">33</span>        From: common.HexToAddress(seller.Account.Address),&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="34"><span class="li_linenum_before_span li_linenum_before_span_hide">34</span>        Password: sellerPassword,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="35"><span class="li_linenum_before_span li_linenum_before_span_hide">35</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="36"><span class="li_linenum_before_span li_linenum_before_span_hide">36</span>    &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="37"><span class="li_linenum_before_span li_linenum_before_span_hide">37</span>    err := cif.SubmitMetaDataIdEncWithBuyer(&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="38"><span class="li_linenum_before_span li_linenum_before_span_hide">38</span>        &amp;txParam,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="39"><span class="li_linenum_before_span li_linenum_before_span_hide">39</span>        txId,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="40"><span class="li_linenum_before_span li_linenum_before_span_hide">40</span>        metaDataIdEncWithBuyer)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="41"><span class="li_linenum_before_span li_linenum_before_span_hide">41</span>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="42"><span class="li_linenum_before_span li_linenum_before_span_hide">42</span>        fmt.Println(<span class="hljs-string">"failed to SubmitMetaDataIdEncWithBuyer, error:"</span>, err)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="43"><span class="li_linenum_before_span li_linenum_before_span_hide">43</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="44"><span class="li_linenum_before_span li_linenum_before_span_hide">44</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e4b9b0e696b9e68bbfe588b0meta20data20idefbc8ce7bb88e4ba8ee58fafe4bba5e4bb8eipfse4b88ae4b88be8bdbde5ae8ce695b4e695b0e68dae_20" class="blank_anchor_name"></a><a id="e4b9b0e696b9e68bbfe588b0meta20data20idefbc8ce7bb88e4ba8ee58fafe4bba5e4bb8eipfse4b88ae4b88be8bdbde5ae8ce695b4e695b0e68dae_20" class="blank_anchor_id"></a><a name="买方拿到meta-data-id终于可以从ipfs上下载完整数据" class="blank_anchor_name"></a><a id="买方拿到meta-data-id终于可以从ipfs上下载完整数据" class="blank_anchor_id"></a>
</div>
<h6 class="xsj_heading_h6"><span class="xsj_heading_content">买方拿到meta data id，终于可以从IPFS上下载完整数据</span></h6>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onReadyForDownload</span><span class="hljs-params">(event events.Event)</span> <span class="hljs-title">bool</span></span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>    metaDataIdEncWithBuyer = event.Data.Get(<span class="hljs-string">"metaDataIdEncBuyer"</span>).([]<span class="hljs-keyword">byte</span>)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>    <span class="hljs-comment">//买方解密metaDataIdEncWithBuyer，得到原始meta data id，根据这个id从IPFS上下载真正的数据</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>    metaDataId, err := accounts.GetAMInstance().Decrypt(&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>        metaDataIdEncWithBuyer,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>        buyer.Account.Address,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>        buyerPassword)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span>        fmt.Println(<span class="hljs-string">"failed to decrypt meta data id with buyer's private key"</span>, err)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="12"><span class="li_linenum_before_span li_linenum_before_span_hide">12</span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="13"><span class="li_linenum_before_span li_linenum_before_span_hide">13</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="14"><span class="li_linenum_before_span li_linenum_before_span_hide">14</span>    &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="15"><span class="li_linenum_before_span li_linenum_before_span_hide">15</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="16"><span class="li_linenum_before_span li_linenum_before_span_hide">16</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e4b9b0e696b9e79c8be5ae8ce695b0e68daeefbc8ce58f8de9a688e695b0e68daee79a84e79c9fe5ae9ee680a7_21" class="blank_anchor_name"></a><a id="e4b9b0e696b9e79c8be5ae8ce695b0e68daeefbc8ce58f8de9a688e695b0e68daee79a84e79c9fe5ae9ee680a7_21" class="blank_anchor_id"></a><a name="买方看完数据反馈数据的真实性" class="blank_anchor_name"></a><a id="买方看完数据反馈数据的真实性" class="blank_anchor_id"></a>
</div>
<h6 class="xsj_heading_h6"><span class="xsj_heading_content">买方看完数据，反馈数据的真实性</span></h6>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ConfirmDataTruth</span><span class="hljs-params">(txId *big.Int)</span></span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>    buyer.SubscribeEvent(<span class="hljs-string">"TransactionClose"</span>, onClose)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>    txParam := chainoperations.TransactParams{&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>        From: common.HexToAddress(buyer.Account.Address),&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>        Password: buyerPassword,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>    &nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>    <span class="hljs-comment">//txId: 本次交易ID</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span>    err := cif.ConfirmDataTruth(&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span>        &amp;txParam,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="12"><span class="li_linenum_before_span li_linenum_before_span_hide">12</span>        txId,&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="13"><span class="li_linenum_before_span li_linenum_before_span_hide">13</span>        <span class="hljs-literal">true</span>)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="14"><span class="li_linenum_before_span li_linenum_before_span_hide">14</span>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="15"><span class="li_linenum_before_span li_linenum_before_span_hide">15</span>        fmt.Println(<span class="hljs-string">"failed to ConfirmDataTruth, error:"</span>, err)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="16"><span class="li_linenum_before_span li_linenum_before_span_hide">16</span>    }&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="17"><span class="li_linenum_before_span li_linenum_before_span_hide">17</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<div class="xiaoshujiang_element xsj_anchor">
  <a name="e4baa4e69893e585b3e997ade9809ae79fa5_22" class="blank_anchor_name"></a><a id="e4baa4e69893e585b3e997ade9809ae79fa5_22" class="blank_anchor_id"></a><a name="交易关闭通知" class="blank_anchor_name"></a><a id="交易关闭通知" class="blank_anchor_id"></a>
</div>
<h6 class="xsj_heading_h6"><span class="xsj_heading_content">交易关闭通知</span></h6>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-golang hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onClose</span><span class="hljs-params">(event events.Event)</span> <span class="hljs-title">bool</span></span> {&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>    fmt.Println(<span class="hljs-string">"onClose:"</span>, event)&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>}&nbsp;<hr class="code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
</div>

</div></div>
</body></html>

