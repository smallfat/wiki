---
title: 机房Filecoin网络刷单系统-High Level设计
tags: 
grammar_cjkRuby: true
---

### 设计原则
- 通过本系统，尽量提高整个机房节点存储算力
- 要求自动化运作程度较高
- 本系统关键参数，可通过控制页面进行调节
- 若机房IDC管理系统支持插件机制，本系统可作为IDC管理系统的一个插件，共享该系统的数据采集，控制等功能

### 业务流程

![Lotus网络刷单流程](./attachments/1576227967742.drawio.html)


### 系统架构
##### 方案

![方案](./attachments/1576229361949.drawio.html)

##### 模块

###### 策略设置
策略设置用来设置刷单系统的各种策略。
- 刷单节点数 - 总共有多少节点参与刷单
- 刷单节点比例 - 客户节点数与存储节点数之比
- 货币转移 - 存储矿工是否将挖矿所得货币自动转移给客户节点钱包
- 货币转移阈值 - 存储矿工在FIL币达到多少时进行转移
- 货币转移值 - 存储矿工转移多少FIL给客户节点钱包
- 刷单时长
- 存储参数 - 包括deal并发数、存储文件大小、存储文件是否自动生成等
- lotus可执行文件版本
- 是否自动生成部署
- 客户节点刷单参数 - 价格、

##### 部署管理
根据设置好的策略，以及收集好的当前lotus网络信息，生成部署配置，并下发到指定节点
- 生成部署信息 - 包括：每个客户节点与相应存储节点的配对信息；每个客户节点的配置信息
- 生成部署文件，放至本地公共可下载站点
- 下发部署 - 将所有信息下发至相应节点，并执行部署脚本，在每个节点上生成执行单元

##### 控制管理
针对单个节点进行管理，如修改刷单参数等，方便管理。

##### Lotus网络信息收集
收集当前Lotus网络中的所有有用信息，包括所有节点IP，Miner信息等。

##### 数据监控
此部分信息若与IDC管理重合，可重用IDC管理系统数据
- OS数据监控 - CPU、Memory等信息
- Lotus数据监控 - 包括每个节点的钱包信息，进程运行信息等

##### 刷单执行单元
- 客户节点执行单元 - 包括定时器、可执行体、配置信息、自动执行脚本等。客户节点从配置信息读取对应存储矿工节点信息，以及价格、miner、文件大小等信息，启动定时器，进行自动刷单动作
- 存储矿工节点执行单元 - 包括可执行体、配置信息、自动执行脚本等。

##### 刷单监控单元
主要与server端数据监控相对应。另外还要根据下发的钱包转账设置，进行自动转账。